<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Team Training Log</title>

  <style>
    * { text-decoration: none; box-sizing: border-box; }

    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background-color: #f9f9f9;
    }

    /* Navbar */
    .navbar { background: #f8bc2c; padding: 10px 20px; min-height: 60px; }
    .navdiv { display: flex; align-items: center; justify-content: space-between; }
    .logo a { font-size: 35px; font-weight: 600; color: black; }

    ul.nav-links {
      display: flex; align-items: center; margin: 0; padding: 0;
      list-style: none; gap: 30px;
    }
    ul.nav-links li a { color: black; font-size: 24px; font-weight: bold; }

    #userContainer {
      display: flex; align-items: center; gap: 10px; flex-wrap: wrap;
    }
    #userContainer button, #userContainer a {
      white-space: nowrap; background-color: black; color: white;
      border: none; border-radius: 6px; padding: 5px 10px;
      font-weight: bold; cursor: pointer; text-decoration: none;
    }
    #userContainer button:hover, #userContainer a:hover { opacity: 0.85; }

    /* Hamburger (mobile only) */
    .hamburger {
      font-size: 28px; background: none; border: none; cursor: pointer; display: none; color:black;
    }

    /* Sidebar (mobile) */
    #sidebar {
      position: fixed; top: 0; left: -100%; width: 70%; max-width: 260px; height: 100%;
      background: #ffffff; box-shadow: 2px 0 6px rgba(0,0,0,0.25);
      transition: left 0.3s ease; padding: 20px; z-index: 1000;
    }
    #overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.45); display: none; z-index: 999;
    }

    /* Main container */
    .container {
      max-width: 600px; margin: 2rem auto; padding: 1rem; background: white;
      border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); width: 90%;
    }

    h1, h2 { text-align: center; }
    form { margin-bottom: 2rem; }
    input, textarea, button {
      display: block; width: 100%; margin: 0.5rem 0; padding: 0.5rem;
    }

    /* Scrollable workouts list */
    ul#logs {
      list-style: none; padding: 0; max-height: 400px; overflow-y: auto;
      border: 1px solid #ccc; border-radius: 6px; background: #fff;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.1); scroll-behavior: smooth;
    }
    ul#logs li {
      background: white; padding: 0.75rem; margin-bottom: 0.5rem;
      border-radius: 6px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);
      word-wrap: break-word;
    }

    /* Edit/Delete button styling */
    .workout-row { display:flex; justify-content:space-between; gap:10px; align-items:flex-start; }
    .workout-info { flex:1; min-width:0; }
    .workout-actions { display:flex; gap:8px; }
    .workout-actions button {
      background:#000; color:#fff; border:none; border-radius:6px; padding:6px 10px;
      font-weight:bold; cursor:pointer;
    }
    .workout-actions button.edit { background:#17396a; }
    .workout-actions button.delete { background:#b00020; }

    /* Mobile responsiveness */
    @media (max-width: 600px) {
      .logo a { font-size: 24px; }
      ul.nav-links, #userContainer { display: none; }
      .hamburger { display: block; color: black;}
      .container { padding: 0.5rem; }
      input, textarea, button { font-size: 14px; padding: 0.4rem; }
      ul#logs { max-height: 300px; }
    }
  </style>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <nav class="navbar">
    <div class="navdiv">
      <button class="hamburger" aria-label="Open menu">&#9776;</button>
      <div class="logo"><a href="#">Tech Training</a></div>

      <!-- Desktop user container -->
      <div id="userContainer"></div>
    </div>
  </nav>

  <!-- Sidebar (mobile) -->
  <div id="sidebar"></div>
  <div id="overlay"></div>

  <div class="container">
    <h1>Team Training Log</h1>

    <!-- Workout Form -->
    <form id="logForm">
      <input type="date" id="date" required>
      <input type="text" id="workout" placeholder="Workout" required>
      <textarea id="notes" placeholder="Notes" required></textarea>
      <button type="submit">Add Workout</button>
    </form>

    <!-- Workout List -->
    <h2>Workouts</h2>
    <ul id="logs"></ul>
  </div>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyAxmrkBALgyOLfaFWtbYuF76n2k3vWmVbo",
      authDomain: "ottraining-69ef4.firebaseapp.com",
      projectId: "ottraining-69ef4",
      storageBucket: "ottraining-69ef4.appspot.com",
      messagingSenderId: "716640190687",
      appId: "1:716640190687:web:23e500028b40f8c81d696a"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const userContainer = document.getElementById('userContainer');
    const form = document.getElementById('logForm');
    const logsList = document.getElementById('logs');

    // Sidebar refs
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');
    const hamburger = document.querySelector('.hamburger');
    const openSidebar = () => { sidebar.style.left = "0"; overlay.style.display = "block"; }
    const closeSidebar = () => { sidebar.style.left = "-100%"; overlay.style.display = "none"; }
    hamburger.addEventListener('click', openSidebar);
    overlay.addEventListener('click', closeSidebar);

    // Auth state
    auth.onAuthStateChanged(async (user) => {
      if (!user) {
        window.location.href = "signup.html";
        return;
      }

      const userRef = db.collection('users').doc(user.uid);
      const doc = await userRef.get();
      const userData = doc.data() || {};
      const role = (userData.role || "").toLowerCase();
      const name = userData.name || user.email;

      // Redirect coaches to coach dashboard
      if (role !== "athlete") {
        window.location.href = "coach_homepage.html";
        return;
      }

      // Desktop navbar
      userContainer.innerHTML = `
        <a href="#">${name}</a>
        <button id="logoutBtn">Logout</button>
      `;
      document.getElementById('logoutBtn').addEventListener('click', () => auth.signOut());

      // Sidebar (mobile)
      sidebar.innerHTML = `
        <div style="display:flex; align-items:center; justify-content:space-between;">
          <h2 style="margin:0; font-size:20px;">Menu</h2>
          <button id="closeSidebar" style="font-size:24px; background:none; border:none; cursor:pointer;">âœ•</button>
        </div>
        <div style="display:flex; flex-direction:column; gap:10px; margin-top:20px;">
          <a href="#" style="background:#000; color:#fff; padding:8px 10px; border-radius:6px; text-decoration:none;">${name}</a>
          <button id="logoutBtnMobile" style="background:#000; color:#fff; padding:10px; border:none; border-radius:6px; cursor:pointer;">Logout</button>
        </div>
      `;
      document.getElementById('closeSidebar').addEventListener('click', closeSidebar);
      document.getElementById('logoutBtnMobile').addEventListener('click', () => auth.signOut());

      // --- Add workout ---
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const date = document.getElementById('date').value;
        const workout = document.getElementById('workout').value;
        const notes = document.getElementById('notes').value;

        try {
          await userRef.collection('workouts').add({
            date,
            workout,
            notes,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
          });
          form.reset();
        } catch (error) {
          console.error("Error adding workout: ", error);
        }
      });

      // --- Render workouts with Edit/Delete ---
      userRef.collection('workouts')
        .orderBy('timestamp', 'desc')
        .onSnapshot((snapshot) => {
          logsList.innerHTML = '';
          snapshot.forEach((docSnap) => {
            const data = docSnap.data();
            const id = docSnap.id;
            const li = document.createElement('li');
            li.innerHTML = `
              <div class="workout-row">
                <div class="workout-info">
                  <strong>${data.date || ''}</strong> - ${data.workout || ''}
                  <br><em>${data.notes || ''}</em>
                </div>
                <div class="workout-actions">
                  <button class="edit" data-id="${id}">Edit</button>
                  <button class="delete" data-id="${id}">Delete</button>
                </div>
              </div>
            `;
            logsList.appendChild(li);
          });
        });

      // --- Edit/Delete handlers ---
      logsList.addEventListener('click', async (e) => {
        const btn = e.target.closest('button');
        if (!btn) return;
        const id = btn.dataset.id;
        const docRef = userRef.collection('workouts').doc(id);

        if (btn.classList.contains('delete')) {
          if (confirm('Delete this workout?')) {
            try { await docRef.delete(); } catch (err) { console.error(err); }
          }
        }

        if (btn.classList.contains('edit')) {
          try {
            const snap = await docRef.get();
            if (!snap.exists) return;
            const w = snap.data();

            const newDate = prompt('Date (YYYY-MM-DD):', w.date || '');
            if (newDate === null) return;
            const newWorkout = prompt('Workout:', w.workout || '');
            if (newWorkout === null) return;
            const newNotes = prompt('Notes:', w.notes || '');
            if (newNotes === null) return;

            await docRef.update({ date: newDate, workout: newWorkout, notes: newNotes });
          } catch (err) {
            console.error(err);
          }
        }
      });
    });
  </script>
</body>
</html>
